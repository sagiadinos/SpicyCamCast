export class SpicyBase{#e=.8;#t=!1;#i=null;#s=null;#r=[];constructor(e){this.#i=e,this.#i.width=this.#i.width||640,this.#i.height=this.#i.height||360}get videoElement(){return this.#i}set isMirror(e){this.#t=e}get isMirror(){return this.#t}set settings(e){this.#s=e}get settings(){return this.#s}get streamList(){return this.#r}set streamList(e){this.#r=e}stop(){this.#r.forEach((e=>{e.getTracks().forEach((e=>{e.stop()}))})),this.videoElement.srcObject=null}capturePhoto(e){return this.capturePhotoAsJpeg(e)}capturePhotoAsPng(e){return(e=this.#a(e)).toDataURL("image/png")}capturePhotoAsJpeg(e){return(e=this.#a(e)).toDataURL("image/jpeg",this.#e)}capturePhotoAsWebp(e){return(e=this.#a(e)).toDataURL("image/webp",this.#e)}#a(e){e.height=this.#s.height,e.width=this.#s.width;let t=e.getContext("2d");return this.#t&&(t.translate(e.width,0),t.scale(-1,1)),t.clearRect(0,0,e.width,e.height),t.drawImage(this.#i,0,0,e.width,e.height),e}}export class SpicyCam extends SpicyBase{#n=[];#o="";constructor(e){super(e)}get camerasList(){return this.#n}countCameras(){return this.#n.length}get currentDeviceId(){return this.#o}getMediaConstraints(){const e={};return e.deviceId={exact:this.#o},e.width={ideal:3840},e.height={ideal:2160},{video:e,audio:!0}}selectCamera(e){for(let t of this.#n)if(e===t.deviceId)return void(this.#o=t.deviceId)}detectVideoDevices(){return new Promise((async(e,t)=>{try{await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});const t=await navigator.mediaDevices.enumerateDevices();this.#n=t.filter((e=>"videoinput"===e.kind)),e(this.#n)}catch(e){console.error("Error accessing media devices:",e),"NotAllowedError"===e.name?t(new Error("Permission to access media devices was denied.")):"NotFoundError"===e.name?t(new Error("No media devices found.")):t(new Error("An unknown error occurred."))}}))}justStart(){return new Promise((async(e,t)=>{try{await this.detectVideoDevices(),this.countCameras()>0?(this.#o=this.#n[0].deviceId,await this.startCamera(),e()):t(new Error("No video device was found."))}catch(e){t(e)}}))}async startCamera(){return new Promise(((e,t)=>{navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then((t=>{const i=t.getVideoTracks()[0];this.settings=i.getSettings(),this.streamList.push(t),this.videoElement.srcObject=t,this.isMirror&&(this.videoElement.style.transform="scale(-1,1)"),this.videoElement.play(),e(this.#o)})).catch((e=>{console.log(e),t(e)}))}))}stopCamera(){this.stop()}}export class SpicyCast extends SpicyBase{#r=[];constructor(e){super(e)}getMediaConstraints(){const e={width:{ideal:3840},height:{ideal:2160}};return{video:e,audio:!1}}async startScreencast(){return new Promise(((e,t)=>{navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((t=>{const i=t.getVideoTracks()[0];this.settings=i.getSettings(),this.#r.push(t),this.videoElement.srcObject=t,e()})).catch((e=>{console.log(e),t(e)}))}))}stopScreencast(){this.stop()}}